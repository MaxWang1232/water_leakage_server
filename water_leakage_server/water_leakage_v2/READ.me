水务漏损预测与检测系统
本系统基于 LSTM 模型和 21 天历史用水数据，实现对单日用水量的预测，并结合真实用量与历史特征判断是否存在水务漏损，提供 RESTful 接口供外部系统调用。
项目功能
用水量预测：基于最近 14 天历史日用水量，使用 LSTM 模型预测当日用水量。
漏损判断：结合真实当日用量、预测用量及 21 天历史数据，按多维度规则判断漏损等级（重度报警、中度报警、轻微提醒或无报警）。
日期校验：自动校验输入的 21 天历史数据是否为连续日期，非连续则返回提示。


water_leakage_v2/
├── water_leakage_main.py               # 主程序（Flask接口）
├── water_leakage_predict.py  # 用水量预测模块（LSTM模型）
├── water_leakage_judge.py    # 漏损判断模块（多规则判断）
├── gun.py               # Gunicorn配置文件
├── requirements.txt     # 依赖库清单
└── README.md            # 项目说明文档

判断代码
水务漏损检测的核心判断逻辑，基于今日真实用水量、预测今日用水量和21 天历史日用水量
通过多维度规则按优先级判断漏损等级（重度报警、中度报警、轻微提醒、无报警）

计算历史统计特征
基于输入的 21 天历史日用水量（history_daily_usages，最近 1 天在前），计算关键统计量（用于后续判断）：
最近 14 天特征：
     recent_14：取前 14 天历史数据（若不足 14 天则取全部）；
     mean_14：最近 14 天的均值（加 1e-6 避免除零）；
     max_3：最近 3 天的最大值（若不足 3 天则为 0）。
21 天特征：
     mean_21：21 天历史数据的均值（加 1e-6 避免除零）；
     max_7：最近 7 天的最大值（若不足 7 天则为 0）；
     prev_7_zero：是否最近 7 天全为 0（用量≤1e-6 视为 0）；
     prev_14_zero：是否最近 14 天全为 0（用量≤1e-6 视为 0）。

1	重度报警	真实今日用量 > 20 倍预测今日用量	                                           真实用量远高于预测（可能是突发漏损）
2	重度报警	真实今日用量 > 20 吨	                                                      真实用量超过绝对阈值（20 吨），属于大额异常
3	中度报警	真实今日用量 > 21 天均值的 25 倍	                                          真实用量远高于 21 天平均水平（长期视角异常）
4	中度报警	真实今日用量 > 最近 14 天均值的 30 倍	                                      真实用量远高于近 14 天平均水平（中期视角异常）
5	中度报警	真实今日用量 > 最近 7 天最大值的 3 倍（且至少有 7 天历史数据）	            真实用量超过近 7 天的峰值（短期峰值异常）
6	中度报警	真实今日用量 > 最近 3 天最大值的 3 倍（且至少有 3 天历史数据）	            真实用量超过近 3 天的峰值（超短期峰值异常）
7	轻微提醒	最近 14 天全为 0，且今日真实用量 > 0（恢复使用）	                            长期停用后突然用水（可能是正常恢复，也可能是异常开启）
8	轻微提醒	最近 7 天全为 0，且今日真实用量 > 0（恢复使用）	                                短期停用后突然用水（可能是正常恢复，也可能是异常开启）
9	无报警	    所有条件均不满足	                                                           用量在正常范围内